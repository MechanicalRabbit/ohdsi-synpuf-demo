# Acute myocardial infarction events

This test case demonstrates the construction of a domain specific
language specific to the generation of OHDSI Cohorts. To get started,
we'll import some boilerplate definitions. This will create the
*DataKnot* called `sp10` that represents our test database.

    include("copybook.jl")

We implement the cohort definition as found in found in `1770674.sql`
that was produced by the JSON found in `1770674.json`, which defines
a cohort for persons experiencing acute myocardial infarction events.

    @define is_myocardial_infarction =
         concept.iscoded("SNOMED", 22298006, 1755008)
    @define is_inpatient_or_er =
         concept.iscoded("Visit", "ERIP", "ER", "IP")

    @query sp10 begin
        condition
        keep(this_event => it)
        keep(this_period => person.observation_period.
                                filter(includes(this_event)).
                                is0to1())
        keep(acute_visit => person.visit.
                                filter(is_inpatient_or_er &&
                                       includes(this_event) &&
                                       during(this_period)))
        filter(is_myocardial_infarction && exists(acute_visit))
        myocardial_infarction_cohort =>
            { person, cohort_entry => start_date,
              cohort_exit => max(end_date, start_date + 7days) }
    end
    #=>
      │ myocardial_infarction_cohort      │
      │ person  cohort_entry  cohort_exit │
    ──┼───────────────────────────────────┼
    1 │ 1780    2008-04-10    2008-04-17  │
    2 │ 30091   2009-08-02    2009-08-09  │
    3 │ 69985   2010-07-22    2010-07-30  │
    4 │ 95538   2009-03-30    2009-04-06  │
    5 │ 107680  2009-07-20    2009-07-30  │
    6 │ 110862  2009-09-30    2009-10-07  │
    =#

